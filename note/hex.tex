% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass{article}

\usepackage{algorithm}
\usepackage{algpseudocode}

\usepackage{natbib}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}

\title{Interlacing Algorithms for Hexagonal Grids}
\author{Jacob Hinkle\\
Oak Ridge National Laboratory\\
hinklejd@ornl.gov \and Debangshu Mukherjee\\
Oak Ridge National Laboratory\\
mukherjeed@ornl.gov}
\date{}

\begin{document}
\maketitle
\begin{abstract}
Progressive refinement of images\ldots{}
\end{abstract}

\section{Introduction}
\label{sec:intro}

Typically, digital images are acquired using a charge-coupled device (CCD) which provides an image supported on a rectilinear grid.
%
However, in some modalities a subject is instead probed in a predefined (and often programmable) pattern to obtain a grid of point measurements.
%
This is the case in scanning probe microscopy (SPM), scanning transmission electron microscopy (STEM), confocal laser scanning microscopy, and others.
%
%In these scanning modalities, sample efficiency and other practical factors are often of the utmost importance.
Particularly when imaging sensitive subjects using invasive modalities such as STEM, sampling efficiency is critical to obtaining useful images before beam-induced damage ruins the sample.
%
To date, the predominant method of scanning in most modalities uses a square pixel grid scan pattern.
%
It is known that hexagonal grid patterns offer optimal sampling for circularly band-limited signals in the sense of minimizing aliasing for a given number of sample points~\citep{petersen1962}.
%
In STEM, some attention has been given to alternative scan patterns including spiral patterns~\citep{sang2016dynamic}, but to our knowledge hexagonal scan patterns have not yet been used in a real-world experiment.


In this note, we explore methods for progressive acquisition or transmission of hexagonal grids which acquire multiple images of increasing resolution each with a full field of view; such methods are known as interlacing methods.
%
Previous approaches to interlacing were designed to reduce the time to formation of an approximate image as additional data is transmitted over a bandwidth-limited connection.
%
The two most popular interlacing methods are scanline interlacing as in high-definition digital video, and Adam7 interlacing as part of the early portable network graphics (PNG) 2D image file format~\citep{rfc2083}.
%
The methods we introduce here extend these works to hexagonal grids, and discuss their characteristics in the context of optimal sampling for scanning imaging modalities.
%
Our methods are simple, scale to any required depth or resolution, and can be
implemented with a series of simple rectilinear sampling grids.


\section{Background}
\label{sec:bg}

\subsection{The Adam7 Algorithm}
\label{sec:adam7}

The Adam7 algorithm

\begin{verbatim}
1 6 4 6 2 6 4 6
7 7 7 7 7 7 7 7
5 6 5 6 5 6 5 6
7 7 7 7 7 7 7 7
3 6 4 6 3 6 4 6
7 7 7 7 7 7 7 7
5 6 5 6 5 6 5 6
7 7 7 7 7 7 7 7
\end{verbatim}

\begin{figure}[ht]
\caption{\label{fig:squareinterlacing} Interlacing methods for rectilinear grids. Left: interlacing alternate lines is common in video. Center: Crocker interlacing for 2D images. Right: Adam7 interlacing developed for the PNG image format based on Crocker.}
\end{figure}

Note that although Adam7 contains 7 passes, it is trivially extended to
any number of passes.

\subsection{Wavelets and Other Methods}
\label{sec:wavelets}

Has hierarchical property and applies to hexagonal grids~ \cite{jeevan2014compression}
, but doesn't work for point sampling methods
like in scanning electron microscopy modalities.


\section{Hexagonal Interlacing Algorithms}
\label{sec:hexinter}

Here we explain two methods for interlacing hexagonal grids.
%
Each method is implemented using rectilinear grids.
%
The first method (double grid interlacing) requires only shifting the grids and doubling the resolution between passes.
%
The second method requires shifting, doubling, and rotating grids.


\subsection{Basic Hex Interlacing}
\label{double-grid-interlacing}

A hexagonal grid can be constructed from two identical rectilinear grids
whose pixel spacings are a multiple of $[1, \sqrt{3}]^T$ and which are offset from one another by half that spacing (see Fig.~\ref{fig:basicphases}, Phase 1).

\begin{figure}[ht]
\centering
% trim=left bottom right top
\includegraphics[trim=140 65 115 10,clip,width=.7\textwidth]{basic_phases.pdf}
\caption{
\label{fig:basicphases} Refining a hex grid through multiple interlacing passes.
%
In each pass, previously sampled points are shown in gray.
%
Each pass consists of multiple rectilinear scans with aspect ratio $\sqrt{3}$.
}
\end{figure}

To refine a coarse hex grid with spacing $s$, we duplicate the grid shifted horizontally by $s/2$ and vertically by $\frac{\sqrt{3}}{2} s$ using two rectilinear grids.
%
The result is a rectilinear grid whose pixel spacing is $[s/2, \sqrt{3}]^T$.
%
We then fill the gaps with a double-resolution rectilinear grid to produce the final double-resolution hex grid with spacing $[s/2, \sqrt{3}/2]^T$.
%
These steps are shown in detail in Algorithm~\ref{alg:basic}
%
We refer to one of these upscaling operations as a "phase" consisting of 3 rectilinear grids.
%
Additional phases are implemented identically, replacing $s$ with $s/2$.

\begin{algorithm}
\caption{Basic hex interlacing algorithm.}\label{alg:basic}
\begin{algorithmic}
	\State $c \gets (0, 0)$
\end{algorithmic}
\end{algorithm}

\subsection{Rotational Hex Interlacing}
\label{triple-grid-interlacing}

Interlaced hex grids are constructed starting from a single point
located at the origin.

\begin{figure}[ht]
\centering
% trim=left bottom right top
\includegraphics[trim=130 100 100 65,clip,width=.9\textwidth]{rotating_phases.pdf}
\caption{
\label{fig:rotatingphases} Refining a hex grid through multiple interlacing passes.
%
In each pass, previously sampled points are shown in gray.
%
Each pass consists of multiple rectilinear scans with aspect ratio $\sqrt{3}$.
}
\end{figure}

\begin{figure}[ht]
\caption{\label{fig:passsizes} Number of points in each pass, by method.}
\end{figure}

\subsection{Montaging}
\label{sec:montaging}

- Very simple with basic method, but no overlap. In practice you need overlap in order to register

- Rotating grid method enables overlap without doubling the dose in those regions!

\section{Conclusion}
\label{sec:conclusion}

Interlaced scan patterns provide a potential for whole-FOV information early in the scan pattern.
%
This could be used in a microscopy setting to correct for sample drift during the scan, or to salvage an image that is degraded due to late-stage beam-induced damage in dose-sensitive samples.
%
Particularly for these dose-sensitive samples, optimal sampling is desired which makes the use of hexagonal grids attractive.
%
The methods we have described in this note provide practical methods for achieving interlaced hexagonal scan patterns.
%
The basic method is readily implemented and easy to handle, as it provides a square (two-grid) hexagonal pattern which is easy to process.
%
The rotating pattern is ideally suited for use in montaging schemes, due to the natural sharing of samples in the overlap regions, which avoids oversampling and introducing unnecessary dose there.

\bibliographystyle{unsrtnat}
\bibliography{hex}

\end{document}
